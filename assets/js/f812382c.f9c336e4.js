"use strict";(self.webpackChunktodo_doc=self.webpackChunktodo_doc||[]).push([[9236],{3523:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"level1/auth/authentication/support-delete","title":"Support Delete","description":"As in update, delete isn\'t going to use the user id in any of its processing yet.","source":"@site/docs/level1/auth/authentication/support-delete.md","sourceDirName":"level1/auth/authentication","slug":"/level1/auth/authentication/support-delete","permalink":"/todo-doc/docs/level1/auth/authentication/support-delete","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":60,"frontMatter":{"sidebar_label":"Support Delete","sidebar_position":60},"sidebar":"tutorialSidebar","previous":{"title":"Support Update","permalink":"/todo-doc/docs/level1/auth/authentication/support-update"},"next":{"title":"Authorization & Responses","permalink":"/todo-doc/docs/level1/auth/auth-resp"}}');var s=t(4848),r=t(8453);const i={sidebar_label:"Support Delete",sidebar_position:60},d="Support Delete",l={},a=[{value:"Front End",id:"front-end",level:2},{value:"API",id:"api",level:2},{value:"Business Object",id:"business-object",level:2},{value:"Verify with Postman",id:"verify-with-postman",level:2},{value:"Verify with Web Page",id:"verify-with-web-page",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"support-delete",children:"Support Delete"})}),"\n",(0,s.jsxs)(n.p,{children:["As in ",(0,s.jsx)(n.strong,{children:"update"}),", ",(0,s.jsx)(n.strong,{children:"delete"})," isn't going to use the user id in any of its processing yet."]}),"\n",(0,s.jsxs)(n.p,{children:["However, we still want to ensure ",(0,s.jsx)(n.strong,{children:"delete"})," is protected - we only want valid users to be able to perform the function. So we will continue modify its endpoint to call ",(0,s.jsx)(n.code,{children:"verifyToken"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"We'll do the following to protect the delete operation:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Front End"}),": Modify the front end ",(0,s.jsx)(n.code,{children:"deleteTodo"})," function to send the Firebase authentication token."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"API"}),": Modify the ",(0,s.jsx)(n.strong,{children:"delete endpoint"})," to make it protected (require authenticated access)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Business Object"}),": At this point, the API handles rejecting unauthenticated requests, so there's nothing to do here."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Verify with Postman"}),": Verify the operation works using Postman."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Verify with Web Page"}),": Verify the operation works using the web page."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"front-end",children:"Front End"}),"\n",(0,s.jsxs)(n.p,{children:["In your html page, the ",(0,s.jsx)(n.code,{children:"deleteTodo"})," javascript likely looks something like this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Delete a todo\nasync function deleteTodo(id) {\n  try {\n    await fetch(`/api/todos/${id}`, {\n      method: "DELETE",\n    });\n    fetchTodos();\n  } catch (error) {\n    console.error("Error deleting todo:", error);\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Update your function to send the authentication header like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Delete a todo\nasync function deleteTodo(id) {\n  try {\n    //highlight-start\n    // Get the user token\n    const token = await getIdToken();\n    //highlight-end\n\n    // Call the api\n    //highlight-start\n    const response = await fetch(`/api/todos/${id}`, {\n      method: "DELETE",\n      headers: {\n        Authorization: "Bearer " + token,\n      },\n      //highlight-end\n    });\n    fetchTodos();\n  } catch (error) {\n    console.error("Error deleting todo:", error);\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"api",children:"API"}),"\n",(0,s.jsxs)(n.p,{children:["Let's update the API endpoint to use our ",(0,s.jsx)(n.code,{children:"verifyToken"})," middleware function."]}),"\n",(0,s.jsx)(n.p,{children:"Your current endpoint likely looks something like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Delete a todo\napp.delete("/api/todos/:id", async (req, res) => {\n  try {\n    const { id } = req.params;\n    const result = await deleteTodo(id);\n    res.json(result);\n  } catch (error) {\n    res.status(500).json({ error: error.message });\n  }\n});\n'})}),"\n",(0,s.jsx)(n.p,{children:"We're only going to protect the endpoint for now, so update your function to look like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Delete a todo\n// highlight-next-line\napp.delete("/api/todos/:id", verifyToken, async (req, res) => {\n  try {\n    const { id } = req.params;\n    const result = await deleteTodo(id);\n    res.json(result);\n  } catch (error) {\n    res.status(500).json({ error: error.message });\n  }\n});\n'})}),"\n",(0,s.jsx)(n.p,{children:"Note: We're not using the user id at this point, so no need to extract it from the request object."}),"\n",(0,s.jsx)(n.h2,{id:"business-object",children:"Business Object"}),"\n",(0,s.jsx)(n.p,{children:"As mentioned above, at this point we're not using the user id in the delete operation, so there's nothing to change."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Before verifying, be sure to restart your server if needed for changes to take place."}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Be sure you have a fresh token. Refresh your web page and view the javascript console for your current auth header."}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Firefox or Chrome may be better than Safari in displaying the entire contents of the auth header."}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"If your browser has been idle for a long time, or you\u2019re accessing your web page from a new browser or tab, your auth header may have a different user id than a previous user id because we\u2019re using anonymous sign-in."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"verify-with-postman",children:"Verify with Postman"}),"\n",(0,s.jsx)(n.p,{children:"Create a new request in Postman"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Type: ",(0,s.jsx)(n.code,{children:"DELETE"})]}),"\n",(0,s.jsxs)(n.li,{children:["URL: ",(0,s.jsx)(n.code,{children:"http://localhost:3004/api/todos/{id}"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Example: ",(0,s.jsx)(n.a,{href:"http://localhost:3004/api/todos/13478",children:"http://localhost:3004/api/todos/13478"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Headers:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Name: Authorization"}),"\n",(0,s.jsxs)(n.li,{children:["Value: Bearer ",(0,s.jsx)(n.code,{children:"<token>"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Expected Response:"}),"\n",(0,s.jsxs)(n.p,{children:["Status code: ",(0,s.jsx)(n.code,{children:"200 OK"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Todo deleted successfully"\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"verify-with-web-page",children:"Verify with Web Page"}),"\n",(0,s.jsxs)(n.p,{children:["Open your web page. You should see ",(0,s.jsx)(n.code,{children:"todos"})," in both the undone and done sections. If not, create some new ",(0,s.jsx)(n.code,{children:"todos"}),". Click the ",(0,s.jsx)(n.strong,{children:"Delete"})," button to verify the operation works."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>d});var o=t(6540);const s={},r=o.createContext(s);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);