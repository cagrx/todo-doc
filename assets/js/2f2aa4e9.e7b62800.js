"use strict";(self.webpackChunktodo_doc=self.webpackChunktodo_doc||[]).push([[7745],{1091:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"level1/deployment/process-mgr","title":"**Using PM2 to Manage Your Node.js Application**","description":"In this lesson, we\u2019ll introduce PM2, a powerful process manager for Node.js applications, and explain why it\u2019s a critical tool for deploying and managing apps in production. You\u2019ll also get hands-on experience with setting up PM2, running your app, and managing its lifecycle.","source":"@site/docs/level1/deployment/process-mgr.md","sourceDirName":"level1/deployment","slug":"/level1/deployment/process-mgr","permalink":"/todo-doc/docs/level1/deployment/process-mgr","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":60,"frontMatter":{"sidebar_label":"Process Manager","sidebar_position":60},"sidebar":"tutorialSidebar","previous":{"title":"Snapshots","permalink":"/todo-doc/docs/level1/deployment/snapshots"},"next":{"title":"Automated Deployment","permalink":"/todo-doc/docs/level1/deployment/auto-deployment"}}');var r=s(4848),i=s(8453);const o={sidebar_label:"Process Manager",sidebar_position:60},a="Using PM2 to Manage Your Node.js Application",l={},d=[{value:"<strong>What Is PM2 and Why Use It?</strong>",id:"what-is-pm2-and-why-use-it",level:2},{value:"<strong>Why PM2?</strong>",id:"why-pm2",level:3},{value:"<strong>Setting Up PM2</strong>",id:"setting-up-pm2",level:2},{value:"<strong>Step 1: Install PM2</strong>",id:"step-1-install-pm2",level:3},{value:"<strong>Step 2: Run Your Application with PM2</strong>",id:"step-2-run-your-application-with-pm2",level:3},{value:"<strong>Step 3: Manage the Application Lifecycle</strong>",id:"step-3-manage-the-application-lifecycle",level:3},{value:"<strong>Step 4: Set Up PM2 for Startup on Boot</strong>",id:"step-4-set-up-pm2-for-startup-on-boot",level:3},{value:"<strong>Handling Backend Changes and Restarting Your Node.js App</strong>",id:"handling-backend-changes-and-restarting-your-nodejs-app",level:2},{value:"<strong>Why Node.js Requires a Restart</strong>",id:"why-nodejs-requires-a-restart",level:3},{value:"<strong>What Happens if You Don&#39;t Restart?</strong>",id:"what-happens-if-you-dont-restart",level:4},{value:"<strong>Restarting the App with PM2</strong>",id:"restarting-the-app-with-pm2",level:3},{value:"<strong>Optional: Automating Restarts During Development</strong>",id:"optional-automating-restarts-during-development",level:3},{value:"<strong>Example: Installing and Using Nodemon</strong>",id:"example-installing-and-using-nodemon",level:4},{value:"<strong>Best Practices for Updating Backend Code</strong>",id:"best-practices-for-updating-backend-code",level:3},{value:"<strong>In Summary</strong>",id:"in-summary",level:3},{value:"<strong>Next Steps</strong>",id:"next-steps",level:2}];function c(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"using-pm2-to-manage-your-nodejs-application",children:(0,r.jsx)(n.strong,{children:"Using PM2 to Manage Your Node.js Application"})})}),"\n",(0,r.jsxs)(n.p,{children:["In this lesson, we\u2019ll introduce ",(0,r.jsx)(n.strong,{children:"PM2"}),", a powerful process manager for Node.js applications, and explain why it\u2019s a critical tool for deploying and managing apps in production. You\u2019ll also get hands-on experience with setting up PM2, running your app, and managing its lifecycle."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"what-is-pm2-and-why-use-it",children:(0,r.jsx)(n.strong,{children:"What Is PM2 and Why Use It?"})}),"\n",(0,r.jsx)(n.p,{children:"PM2 is a production-grade process manager for Node.js applications. It provides an easy way to manage, monitor, and keep your applications running 24/7."}),"\n",(0,r.jsx)(n.h3,{id:"why-pm2",children:(0,r.jsx)(n.strong,{children:"Why PM2?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Persistent Applications"}),": You may have noticed in the previous example, when you started your app using ",(0,r.jsx)(n.code,{children:"node server.js"})," and then closed your SSH session, the app stopped running. PM2 solves this problem by keeping your app running in the background."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Automatic Restarts"}),": PM2 automatically restarts your app if it crashes, ensuring high availability."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Startup on Boot"}),": PM2 can configure your app to start automatically when the server reboots."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitoring Tools"}),": PM2 provides tools to monitor your app's CPU and memory usage in real time."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"setting-up-pm2",children:(0,r.jsx)(n.strong,{children:"Setting Up PM2"})}),"\n",(0,r.jsx)(n.p,{children:"Follow these steps to install and configure PM2 on your Lightsail instance."}),"\n",(0,r.jsx)(n.h3,{id:"step-1-install-pm2",children:(0,r.jsx)(n.strong,{children:"Step 1: Install PM2"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["SSH into your Lightsail instance:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -i keys/lightsail-key.pem bitnami@<lightsail-instance-ip>\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Install PM2 globally using npm:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo npm install -g pm2\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Verify the installation:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 --version\n"})}),"\n","You should see the PM2 version number if it was installed successfully."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"step-2-run-your-application-with-pm2",children:(0,r.jsx)(n.strong,{children:"Step 2: Run Your Application with PM2"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Navigate to your app directory (e.g., ",(0,r.jsx)(n.code,{children:"~/todo-app"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/todo-app\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Start your app using PM2:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'pm2 start server.js --name "todo-app"\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Replace ",(0,r.jsx)(n.code,{children:"server.js"})," with the entry point of your app."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"--name"})," flag assigns a name to your process for easier management."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Check the running processes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 list\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["You should see your app (",(0,r.jsx)(n.code,{children:"todo-app"}),") listed with a status of ",(0,r.jsx)(n.code,{children:"online"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"View real-time logs for your app:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 logs todo-app\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"Ctrl+C"})," to exit the logs."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Verify your app is running by opening a browser and navigating to it."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"step-3-manage-the-application-lifecycle",children:(0,r.jsx)(n.strong,{children:"Step 3: Manage the Application Lifecycle"})}),"\n",(0,r.jsx)(n.p,{children:"PM2 provides commands to manage your app at every stage of its lifecycle. Here are some key commands:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Restart the App"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 restart todo-app\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Stop the App"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 stop todo-app\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Delete the App"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 delete todo-app\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"View Detailed App Information"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 describe todo-app\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"step-4-set-up-pm2-for-startup-on-boot",children:(0,r.jsx)(n.strong,{children:"Step 4: Set Up PM2 for Startup on Boot"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Reminder:"})," If you experimented with the commands in the previous step and deleted your app from PM2, make sure to add it back before continuing. Use the following command to start your app:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'pm2 start server.js --name "todo-app"\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Configure PM2 to start your app automatically when the server reboots:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 startup\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["PM2 will output a command specific to your server\u2019s environment. Run the command it provides (e.g., ",(0,r.jsx)(n.code,{children:"sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u bitnami --hp /home/bitnami"}),")."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important:"})," Be sure to copy and paste the command your server provides, not the one shown in the example above, as they may differ."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Save the current PM2 process list so it restarts on boot:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 save\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Test the setup by rebooting the server:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo reboot\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"After the server restarts, reconnect via SSH and check if the app is running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 list\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"handling-backend-changes-and-restarting-your-nodejs-app",children:(0,r.jsx)(n.strong,{children:"Handling Backend Changes and Restarting Your Node.js App"})}),"\n",(0,r.jsxs)(n.p,{children:["When working on your backend, you might need to update the application code, such as adding a new route to ",(0,r.jsx)(n.code,{children:"server.js"}),". After using ",(0,r.jsx)(n.code,{children:"rsync"})," to upload the updated files to the server, you\u2019ll need to take an additional step to apply these changes. Here's how to handle this scenario."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"why-nodejs-requires-a-restart",children:(0,r.jsx)(n.strong,{children:"Why Node.js Requires a Restart"})}),"\n",(0,r.jsxs)(n.p,{children:["Node.js loads your code into memory when the application starts. Once the app is running, it doesn\u2019t automatically detect changes to your source files. This means that if you update a file, such as ",(0,r.jsx)(n.code,{children:"server.js"}),", the running Node.js process won\u2019t incorporate the new changes unless it is restarted."]}),"\n",(0,r.jsx)(n.h4,{id:"what-happens-if-you-dont-restart",children:(0,r.jsx)(n.strong,{children:"What Happens if You Don't Restart?"})}),"\n",(0,r.jsxs)(n.p,{children:["Even after deploying changes using ",(0,r.jsx)(n.code,{children:"rsync"}),", the running application will continue using the old version of your code. This behavior ensures stability in production but requires manual intervention to apply updates."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"restarting-the-app-with-pm2",children:(0,r.jsx)(n.strong,{children:"Restarting the App with PM2"})}),"\n",(0,r.jsxs)(n.p,{children:["If you\u2019re using PM2 to manage your Node.js app (as described in the previous section), restarting is straightforward. After uploading your changes with ",(0,r.jsx)(n.code,{children:"rsync"}),", restart your app as follows:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["SSH into your Lightsail instance:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -i keys/lightsail-key.pem bitnami@<lightsail-instance-ip>\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Restart the app using PM2:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 restart todo-app\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Replace ",(0,r.jsx)(n.code,{children:"todo-app"})," with the name of your app as configured in PM2."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["This command stops the currently running process and starts it again, reloading the updated ",(0,r.jsx)(n.code,{children:"server.js"}),"."]}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["Verify the app is running and using the updated code:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 list\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"optional-automating-restarts-during-development",children:(0,r.jsx)(n.strong,{children:"Optional: Automating Restarts During Development"})}),"\n",(0,r.jsxs)(n.p,{children:["During local development, you can use tools like ",(0,r.jsx)(n.strong,{children:"nodemon"})," to automatically restart your app whenever you make changes. Nodemon watches for file changes and reloads the server without manual intervention."]}),"\n",(0,r.jsx)(n.h4,{id:"example-installing-and-using-nodemon",children:(0,r.jsx)(n.strong,{children:"Example: Installing and Using Nodemon"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Install nodemon locally:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install -g nodemon\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Run your app with nodemon:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"nodemon server.js\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important:"})," Nodemon is only recommended for development. In production, use PM2 or other production-grade tools to manage your app."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"best-practices-for-updating-backend-code",children:(0,r.jsx)(n.strong,{children:"Best Practices for Updating Backend Code"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test Locally First"}),": Before deploying updates, test them thoroughly in your local environment."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sync Files Using Rsync"}),": Use ",(0,r.jsx)(n.code,{children:"rsync"})," to upload only the changed files to the server."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Restart the App"}),": Always restart the Node.js process after deploying changes to ensure the updates take effect."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Verify After Deployment"}),": Check the app logs and functionality to confirm the changes were applied successfully."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"in-summary",children:(0,r.jsx)(n.strong,{children:"In Summary"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Node.js does not automatically incorporate changes after a file update."}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"pm2 restart"})," to reload your application after deploying new code."]}),"\n",(0,r.jsx)(n.li,{children:"For development, tools like nodemon can simplify the process of reloading changes automatically."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"By following these steps, you\u2019ll ensure that your updates are applied correctly without disrupting the stability of your application."}),"\n",(0,r.jsx)(n.p,{children:"Let me know if you\u2019d like further assistance! \ud83d\ude80"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:(0,r.jsx)(n.strong,{children:"Next Steps"})}),"\n",(0,r.jsx)(n.p,{children:"With PM2 configured and running your app, your application is now resilient to server crashes and reboots. In the next section, we\u2019ll focus on optimizing your deployment process and managing updates to your app in production."}),"\n",(0,r.jsx)(n.p,{children:"Let\u2019s keep going! \ud83d\ude80"})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(6540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);